// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

enum IntentStatus {
  Inactive
  Active
  Paused
  Cancelled
  Deleted
}

model Intent {
  id         String       @id @default(cuid())
  startDate  DateTime
  endDate    DateTime
  status     IntentStatus
  isPublic   Boolean
  successYes Int
  successNo  Int
  reminders  String // Or JSON?
  createdAt  DateTime     @default(now())

  // Relationships
  user   User   @relation("UserIntents", fields: [userId], references: [id])
  aim    Aim    @relation("AimIntents", fields: [aimId], references: [id])
  tags   Tag[]  @relation("IntentTags")

  // Added to improve query performance
  //  userId and aimId are required to be stored
  //  as properties within the Intent object
  userId String
  aimId  String

  // Indexes
  @@index([userId], name: "user_id_index")
  @@index([aimId], name: "aim_id_index")
}

enum UserRole {
  User
  GroupManager
  Admin
}

model User {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  role      UserRole
  timezone  String
  createdAt DateTime @default(now())

  // Relationships
  intents Intent[] @relation("UserIntents")
  groups  Group[]  @relation("GroupMembers")
  aims    Aim[]    @relation("AimParticipants")
  tags    Tag[]    @relation("UserTags")
}

model Group {
  id        String   @id @default(cuid())
  title     String
  createdAt DateTime @default(now())

  // Relationships
  users User[] @relation("GroupMembers")
  aims  Aim[]  @relation("GroupAims")
  tags  Tag[]  @relation("GroupTags")
}

model Aim {
  id              String   @id @default(cuid())
  title           String
  helpfulnessLow  Int
  helpfulnessMid  Int
  helpfulnessHigh Int
  createdAt       DateTime @default(now())

  // Relationships
  groups  Group[]  @relation("GroupAims")
  intents Intent[] @relation("AimIntents")
  tags    Tag[]    @relation("AimTags")
  users   User[]   @relation("AimParticipants")

  // Indexes
  @@index([helpfulnessLow], name: "helpfulnessLow_index")
  @@index([helpfulnessMid], name: "helpfulnessMid_index")
  @@index([helpfulnessHigh], name: "helpfulnessHigh_index")
}

model Tag {
  id        String   @id @default(cuid())
  title     String
  createdAt DateTime @default(now())

  // Relationships
  aims    Aim[]    @relation("AimTags")
  groups  Group[]  @relation("GroupTags")
  users   User[]   @relation("UserTags")
  intents Intent[] @relation("IntentTags")
}
